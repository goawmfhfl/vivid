import type { Record } from "./types";

export function buildEmotionPrompt(
  records: Record[],
  date: string,
  dayOfWeek: string,
  isPro: boolean = false
): string {
  const emotionRecords = records.filter((r) => r.type === "emotion");

  if (emotionRecords.length === 0) {
    return "";
  }

  const instruction = isPro
    ? "ê°ì • ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”. ìƒì„¸í•œ ê°ì • ë¶„ì„ê³¼ ì‹œê°„ëŒ€ë³„ ë³€í™”ë¥¼ ê¹Šì´ ìžˆê²Œ ë¶„ì„í•˜ì„¸ìš”."
    : "ê°ì • ë¦¬í¬íŠ¸ë¥¼ ê°„ë‹¨í•˜ê²Œ ìƒì„±í•˜ì„¸ìš”. í•µì‹¬ ê°ì •ë§Œ ê°„ê²°í•˜ê²Œ ì•Œë ¤ì£¼ì„¸ìš”.";

  let prompt = `ì•„ëž˜ëŠ” ${date} (${dayOfWeek}) í•˜ë£¨ì˜ ê°ì • ê¸°ë¡ìž…ë‹ˆë‹¤. ${instruction}\n\n`;

  emotionRecords.forEach((record, idx) => {
    const createdAt = new Date(record.created_at);
    const kstTime = createdAt.toLocaleTimeString("ko-KR", {
      hour: "2-digit",
      minute: "2-digit",
      timeZone: "Asia/Seoul",
    });
    prompt += `${idx + 1}. [${kstTime}] ${record.content}\n`;
  });

  // ì‹œê°„ ì •ë³´ ìš”ì•½
  prompt += "\n=== ë ˆì½”ë“œ ìƒì„± ì‹œê°„ ì •ë³´ ===\n";
  prompt +=
    "ìœ„ ì‹œê°„ ì •ë³´ë¥¼ ì°¸ê³ í•˜ì—¬ emotion_timelineì„ ìƒì„±í•˜ì„¸ìš”. ê° ë ˆì½”ë“œì˜ created_atì„ í•œêµ­ ì‹œê°„(Asia/Seoul)ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì‹œê°„ëŒ€ë³„ë¡œ ê·¸ë£¹í™”í•˜ê³ , í•´ë‹¹ ì‹œê°„ëŒ€ì˜ ê°ì •ì„ ë¶„ì„í•˜ì„¸ìš”.\n";
  prompt +=
    "ì¤‘ìš”: emotion_timelineì€ ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ìƒì„±í•˜ì„¸ìš”. ê°€ìž¥ ì¤‘ìš”í•œ ì‹œê°„ëŒ€ì˜ ê°ì • ë³€í™”ë§Œ ì„ ë³„í•˜ì—¬ í¬í•¨í•˜ê³ , ë¹„ìŠ·í•œ ì‹œê°„ëŒ€ì˜ ê°ì •ì€ í†µí•©í•˜ê±°ë‚˜ ê°€ìž¥ ëŒ€í‘œì ì¸ ê°ì •ë§Œ ì„ íƒí•˜ì„¸ìš”.\n";

  return prompt;
}

export function buildVividPrompt(
  records: Record[],
  date: string,
  dayOfWeek: string,
  isPro: boolean = false
): string {
  const dreamRecords = records.filter((r) => r.type === "vivid" || r.type === "dream");

  if (dreamRecords.length === 0) {
    return "";
  }

  const instruction = isPro
    ? [
        "VIVID ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.",
        "ì•„ëž˜ JSON ìŠ¤í‚¤ë§ˆì— ë§žê²Œ ì±„ì›Œì£¼ì„¸ìš”.",
        "",
        "VIVID ê¸°ë¡ì€ ë‘ ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆìŠµë‹ˆë‹¤:",
        "- Q1: ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì–´ë–»ê²Œ ë³´ë‚¼ê¹Œ? (í˜„ìž¬ ëª¨ìŠµ)",
        "- Q2: ì•žìœ¼ë¡œì˜ ë‚˜ëŠ” ì–´ë–¤ ëª¨ìŠµì¼ê¹Œ? (ë¯¸ëž˜ ë¹„ì „)",
        "",
        "### ðŸ“ ì˜¤ëŠ˜ì˜ VIVID (í˜„ìž¬ ëª¨ìŠµ) - Q1 ë¶„ì„",
        "1) current_summary:",
        "- Q1ì— ëŒ€í•œ ë‹µë³€ì„ ë¶„ì„í•˜ì—¬ ì˜¤ëŠ˜ ê¸°ë¡í•œ VIVID ë‚´ìš©ì˜ ìš”ì•½ì„ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- í•˜ë£¨ì˜ í•µì‹¬ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ì •ë¦¬í•˜ë˜, ìµœëŒ€ 300ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "2) current_evaluation:",
        "- Q1ì— ëŒ€í•œ ë‹µë³€ì„ ë°”íƒ•ìœ¼ë¡œ ì˜¤ëŠ˜ì˜ VIVID ê¸°ë¡ì— ëŒ€í•œ AI í‰ê°€ë¥¼ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- í˜„ìž¬ ìƒíƒœì— ëŒ€í•œ ê°ê´€ì  ë¶„ì„ì„ ë‹´ë°±í•˜ê³  ë”°ëœ»í•œ í†¤ìœ¼ë¡œ ìž‘ì„±í•˜ë˜, ìµœëŒ€ 250ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "3) current_keywords:",
        "- Q1 ë‹µë³€ì—ì„œ ìžì£¼ ë“±ìž¥í•œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.",
        "- í˜„ìž¬ ê´€ì‹¬ì‚¬ì™€ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•µì‹¬ ë‹¨ì–´ë“¤ë¡œ 5~8ê°œ ì •ë„ ë½‘ì•„ì£¼ì„¸ìš”.",
        "",
        "### ðŸŽ¯ ì•žìœ¼ë¡œì˜ ë‚˜ì˜ ëª¨ìŠµ (ë¯¸ëž˜ ë¹„ì „) - Q2 ë¶„ì„",
        "4) future_summary:",
        "- Q2ì— ëŒ€í•œ ë‹µë³€ì„ ë¶„ì„í•˜ì—¬ ê¸°ë¡ì—ì„œ ë“œëŸ¬ë‚œ 'ì•žìœ¼ë¡œ ë˜ê³  ì‹¶ì€ ëª¨ìŠµ' ìš”ì•½ì„ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- ë¯¸ëž˜ ë¹„ì „ì˜ í•µì‹¬ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ì •ë¦¬í•˜ë˜, ìµœëŒ€ 300ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "5) future_evaluation:",
        "- Q2ì— ëŒ€í•œ ë‹µë³€ì„ ë°”íƒ•ìœ¼ë¡œ ê·¸ ë¹„ì „ì— ëŒ€í•œ AI í‰ê°€ë¥¼ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- ë¹„ì „ì˜ ëª…í™•ì„±ê³¼ ì‹¤í˜„ ê°€ëŠ¥ì„±ì„ ë¶„ì„í•˜ë˜, ìµœëŒ€ 250ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "6) future_keywords:",
        "- Q2 ë‹µë³€ì—ì„œ ìžì£¼ ë“±ìž¥í•œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.",
        "- ì§€í–¥í•˜ëŠ” ê°€ì¹˜ì™€ ëª©í‘œë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•µì‹¬ ë‹¨ì–´ë“¤ë¡œ 5~8ê°œ ì •ë„ ë½‘ì•„ì£¼ì„¸ìš”.",
        "",
        "### ðŸ“Š ì¼ì¹˜ë„ ë¶„ì„",
        "7) alignment_score:",
        "- ì˜¤ëŠ˜ì˜ ëª¨ìŠµ(Q1) vs ì•žìœ¼ë¡œ ë˜ê³  ì‹¶ì€ ëª¨ìŠµ(Q2)ì˜ ì¼ì¹˜ë„ë¥¼ 0-100ì  ì²™ë„ë¡œ í‰ê°€í•©ë‹ˆë‹¤.",
        "- í˜„ìž¬ì™€ ëª©í‘œì˜ ê±°ë¦¬ë¥¼ ì¸¡ì •í•˜ì—¬ ì ìˆ˜ë¥¼ ë¶€ì—¬í•˜ì„¸ìš”.",
        "- ì˜ˆ: 85ì  (ë†’ì€ ì¼ì¹˜ë„), 45ì  (ì¤‘ê°„ ì¼ì¹˜ë„), 20ì  (ë‚®ì€ ì¼ì¹˜ë„)",
        "",
        "### ðŸ” ì‚¬ìš©ìž íŠ¹ì„± ë¶„ì„",
        "8) user_characteristics:",
        "- ê¸°ë¡ íŒ¨í„´ê³¼ ë‚´ìš©ì„ ë¶„ì„í•´ ë„ì¶œí•œ ì‚¬ìš©ìž íŠ¹ì„±ì„ ìµœëŒ€ 5ê°€ì§€ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- 'ë„ˆëŠ” ì´ëŸ° ì‚¬ëžŒì´ë‹¤'ë¼ê³  ë‚™ì¸ì°ì§€ ë§ê³ , ê°€ëŠ¥ì„±ê³¼ ë°©í–¥ì„±ì„ ë³´ì—¬ì£¼ëŠ” ë¬¸ìž¥ìœ¼ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        '- ì˜ˆ: "ìžê¸° ì„±ì°°ì„ ì¤‘ì‹œí•˜ëŠ”", "ë¯¸ëž˜ ì§€í–¥ì ì¸", "ê°ì • í‘œí˜„ì´ í’ë¶€í•œ" ë“±',
        "",
        "9) aspired_traits:",
        "- ì˜¤ëŠ˜ì˜ VIVID ê¸°ë¡(Q1, Q2 ëª¨ë‘)ì—ì„œ ë“œëŸ¬ë‚œ ì§€í–¥ ëª¨ìŠµì„ ìµœëŒ€ 5ê°€ì§€ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- ì‚¬ìš©ìžê°€ ì¶”êµ¬í•˜ëŠ” ê°€ì¹˜ì™€ ë°©í–¥ì„±ì„ ë‚˜íƒ€ë‚´ëŠ” íŠ¹ì„±ìœ¼ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        '- ì˜ˆ: "ê· í˜• ìž¡ížŒ ì‚¶ì„ ì¶”êµ¬í•˜ëŠ”", "ì°½ì˜ì ì¸ ë¬¸ì œ í•´ê²°ìž", "íƒ€ì¸ê³¼ì˜ ê¹Šì€ ì—°ê²°ì„ ì›í•˜ëŠ”" ë“±',
        "",
        "í†¤ì€ ë‹´ë°±í•˜ê³  ê³¼í•˜ì§€ ì•Šê²Œ, ì‚¬ìš©ìžë¥¼ ì¡°ìš©ížˆ ì‘ì›í•˜ëŠ” í˜¸ìŠ¤íŠ¸ì²˜ëŸ¼ ìž‘ì„±í•˜ì„¸ìš”.",
      ].join("\n")
    : [
        "VIVID ë¦¬í¬íŠ¸ë¥¼ ê°„ë‹¨í•˜ê²Œ ìƒì„±í•˜ì„¸ìš”.",
        "ì•„ëž˜ JSON ìŠ¤í‚¤ë§ˆì— ë§žê²Œ ì±„ì›Œì£¼ì„¸ìš”.",
        "",
        "VIVID ê¸°ë¡ì€ ë‘ ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆìŠµë‹ˆë‹¤:",
        "- Q1: ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì–´ë–»ê²Œ ë³´ë‚¼ê¹Œ? (í˜„ìž¬ ëª¨ìŠµ)",
        "- Q2: ì•žìœ¼ë¡œì˜ ë‚˜ëŠ” ì–´ë–¤ ëª¨ìŠµì¼ê¹Œ? (ë¯¸ëž˜ ë¹„ì „)",
        "",
        "1) current_summary: Q1 ë‹µë³€ ìš”ì•½ (150ìž ì´ë‚´)",
        "2) current_evaluation: Q1 ë‹µë³€ í‰ê°€ (200ìž ì´ë‚´)",
        "3) current_keywords: Q1 ë‹µë³€ í‚¤ì›Œë“œ (3~5ê°œ)",
        "",
        "4) future_summary: Q2 ë‹µë³€ ìš”ì•½ (150ìž ì´ë‚´)",
        "5) future_evaluation: Q2 ë‹µë³€ í‰ê°€ (200ìž ì´ë‚´)",
        "6) future_keywords: Q2 ë‹µë³€ í‚¤ì›Œë“œ (3~5ê°œ)",
        "",
        "7) alignment_score: Q1ê³¼ Q2ì˜ ì¼ì¹˜ë„ (0-100ì )",
        "",
        "8) user_characteristics: ì‚¬ìš©ìž íŠ¹ì„± (ìµœëŒ€ 3ê°œ, ê°„ë‹¨í•˜ê²Œ)",
        "9) aspired_traits: ì§€í–¥í•˜ëŠ” ëª¨ìŠµ (ìµœëŒ€ 3ê°œ, ê°„ë‹¨í•˜ê²Œ)",
      ].join("\n");

  let prompt = `ì•„ëž˜ëŠ” ${date} (${dayOfWeek}) í•˜ë£¨ì˜ VIVID ê¸°ë¡ìž…ë‹ˆë‹¤.\n${instruction}\n\n`;

  dreamRecords.forEach((record, idx) => {
    const createdAt = new Date(record.created_at);
    const kstTime = createdAt.toLocaleTimeString("ko-KR", {
      hour: "2-digit",
      minute: "2-digit",
      timeZone: "Asia/Seoul",
    });
    prompt += `${idx + 1}. [${kstTime}] ${record.content}\n`;
  });

  return prompt;
}
