import type { Record } from "./types";

export function buildReportPrompt(
  records: Record[],
  date: string,
  dayOfWeek: string,
  isPro: boolean = false
): string {
  const dreamRecords = records.filter((r) => r.type === "vivid" || r.type === "dream");

  if (dreamRecords.length === 0) {
    return "";
  }

  const instruction = isPro
    ? [
        "VIVID ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.",
        "ì•„ëž˜ JSON ìŠ¤í‚¤ë§ˆì— ë§žê²Œ ì±„ì›Œì£¼ì„¸ìš”.",
        "",
        "VIVID ê¸°ë¡ì€ ë‘ ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆìŠµë‹ˆë‹¤:",
        "- Q1: ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì–´ë–»ê²Œ ë³´ë‚¼ê¹Œ? (í˜„ìž¬ ëª¨ìŠµ)",
        "- Q2: ì•žìœ¼ë¡œì˜ ë‚˜ëŠ” ì–´ë–¤ ëª¨ìŠµì¼ê¹Œ? (ë¯¸ëž˜ ë¹„ì „)",
        "",
        "### ðŸ“ ì˜¤ëŠ˜ì˜ VIVID (í˜„ìž¬ ëª¨ìŠµ) - Q1 ë¶„ì„",
        "1) current_summary:",
        "- Q1ì— ëŒ€í•œ ë‹µë³€ì„ ë¶„ì„í•˜ì—¬ ì˜¤ëŠ˜ ê¸°ë¡í•œ VIVID ë‚´ìš©ì˜ ìš”ì•½ì„ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- í•˜ë£¨ì˜ í•µì‹¬ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ì •ë¦¬í•˜ë˜, êµ¬ì²´ì ì¸ ì¸ì‚¬ì´íŠ¸ì™€ ë§¥ë½ì„ í¬í•¨í•˜ì—¬ ìµœëŒ€ 400ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "2) current_evaluation:",
        "- Q1ì— ëŒ€í•œ ë‹µë³€ì„ ë°”íƒ•ìœ¼ë¡œ ì˜¤ëŠ˜ì˜ VIVID ê¸°ë¡ì— ëŒ€í•œ AI í‰ê°€ë¥¼ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- í˜„ìž¬ ìƒíƒœì— ëŒ€í•œ ê°ê´€ì  ë¶„ì„ì„ ë‹´ë°±í•˜ê³  ë”°ëœ»í•œ í†¤ìœ¼ë¡œ ìž‘ì„±í•˜ë˜, ìµœëŒ€ 250ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "3) current_keywords:",
        "- Q1 ë‹µë³€ì—ì„œ ìžì£¼ ë“±ìž¥í•œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.",
        "- í˜„ìž¬ ê´€ì‹¬ì‚¬ì™€ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•µì‹¬ ë‹¨ì–´ë“¤ë¡œ 5~8ê°œ ì •ë„ ë½‘ì•„ì£¼ì„¸ìš”.",
        "",
        "### ðŸŽ¯ ì•žìœ¼ë¡œì˜ ë‚˜ì˜ ëª¨ìŠµ (ë¯¸ëž˜ ë¹„ì „) - Q2 ë¶„ì„",
        "4) future_summary:",
        "- Q2ì— ëŒ€í•œ ë‹µë³€ì„ ë¶„ì„í•˜ì—¬ ê¸°ë¡ì—ì„œ ë“œëŸ¬ë‚œ 'ì•žìœ¼ë¡œ ë˜ê³  ì‹¶ì€ ëª¨ìŠµ' ìš”ì•½ì„ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- ë¯¸ëž˜ ë¹„ì „ì˜ í•µì‹¬ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ì •ë¦¬í•˜ë˜, êµ¬ì²´ì ì¸ ì¸ì‚¬ì´íŠ¸ì™€ ë§¥ë½ì„ í¬í•¨í•˜ì—¬ ìµœëŒ€ 400ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "5) future_evaluation:",
        "- Q2ì— ëŒ€í•œ ë‹µë³€ì„ ë°”íƒ•ìœ¼ë¡œ ê·¸ ë¹„ì „ì— ëŒ€í•œ AI í‰ê°€ë¥¼ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- ë¹„ì „ì˜ ëª…í™•ì„±ê³¼ ì‹¤í˜„ ê°€ëŠ¥ì„±ì„ ë¶„ì„í•˜ë˜, ìµœëŒ€ 250ìž ì´ë‚´ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        "",
        "6) future_keywords:",
        "- Q2 ë‹µë³€ì—ì„œ ìžì£¼ ë“±ìž¥í•œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.",
        "- ì§€í–¥í•˜ëŠ” ê°€ì¹˜ì™€ ëª©í‘œë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•µì‹¬ ë‹¨ì–´ë“¤ë¡œ 5~8ê°œ ì •ë„ ë½‘ì•„ì£¼ì„¸ìš”.",
        "",
        "### ðŸ“Š ì¼ì¹˜ë„ ë¶„ì„",
        "7) alignment_score:",
        "- Q1ê³¼ Q2ì˜ ë‚´ìš©ì´ ì–¼ë§ˆë‚˜ ìœ ì‚¬í•œì§€ ë‹¨ìˆœ ë¹„êµí•´ 0-100ì ìœ¼ë¡œ ì‚°ì •í•©ë‹ˆë‹¤",
        "- ê¸°ì¤€: í•µì‹¬ í‚¤ì›Œë“œ/ì£¼ì œì˜ ê²¹ì¹¨ ì •ë„ë§Œ ë°˜ì˜í•˜ì„¸ìš”",
        "- ë†’ì€ ì ìˆ˜(80ì  ì´ìƒ): ìœ ì‚¬í•œ í‚¤ì›Œë“œÂ·ì£¼ì œê°€ ë§Žì´ ê²¹ì¹¨",
        "- ì¤‘ê°„ ì ìˆ˜(50-79ì ): ì¼ë¶€ë§Œ ê²¹ì¹¨",
        "- ë‚®ì€ ì ìˆ˜(50ì  ë¯¸ë§Œ): ê±°ì˜ ê²¹ì¹˜ì§€ ì•ŠìŒ",
        "- ê³¼ë„í•œ í•´ì„ ì—†ì´ ìœ ì‚¬ì„±ë§Œ íŒë‹¨í•˜ì„¸ìš”",
        "- ê²°ê³¼ëŠ” ê°€ëŠ¥í•œ í•œ ë¹ ë¥´ê²Œ ì‚°ì¶œí•˜ì„¸ìš”",
        "",
        "8) alignment_score_reason:",
        "- Q1ê³¼ Q2 ì‚¬ì´ì—ì„œ í•µì‹¬ì ìœ¼ë¡œ ê²¹ì¹˜ëŠ” í‚¤ì›Œë“œë‚˜ ì£¼ì œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.",
        "- ì ìˆ˜ ì‚°ì •ì˜ êµ¬ì²´ì ì¸ ê·¼ê±°ë¥¼ 3~5ê°œì˜ ì§§ì€ ë¬¸ìž¥ì´ë‚˜ í‚¤ì›Œë“œë¡œ ë¦¬ìŠ¤íŠ¸ì—…í•©ë‹ˆë‹¤.",
        '- ì˜ˆì‹œ: ["\'ì„±ìž¥\'ì´ë¼ëŠ” ê³µí†µ í‚¤ì›Œë“œ", "ì•„ì¹¨ ìš´ë™ì— ëŒ€í•œ ì˜ì§€ê°€ ì¼ì¹˜í•¨", "ìƒˆë¡œìš´ ë„ì „ì— ëŒ€í•œ ê¸ì •ì  íƒœë„"]',
        "- ê²¹ì¹˜ëŠ” ì£¼ì œê°€ ì ìœ¼ë©´ \"ê³µí†µ ì£¼ì œê°€ ê±°ì˜ ì—†ìŒ\"ê³¼ ê°™ì´ ëª…ì‹œí•˜ì„¸ìš”.",
        "",
        "### ðŸ” ì‚¬ìš©ìž íŠ¹ì„± ë¶„ì„",
        "9) user_characteristics:",
        "- ê¸°ë¡ íŒ¨í„´ê³¼ ë‚´ìš©ì„ ë¶„ì„í•´ ë„ì¶œí•œ ì‚¬ìš©ìž íŠ¹ì„±ì„ ìµœëŒ€ 5ê°€ì§€ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- 'ë„ˆëŠ” ì´ëŸ° ì‚¬ëžŒì´ë‹¤'ë¼ê³  ë‚™ì¸ì°ì§€ ë§ê³ , ê°€ëŠ¥ì„±ê³¼ ë°©í–¥ì„±ì„ ë³´ì—¬ì£¼ëŠ” ë¬¸ìž¥ìœ¼ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        '- ì˜ˆ: "ìžê¸° ì„±ì°°ì„ ì¤‘ì‹œí•˜ëŠ”", "ë¯¸ëž˜ ì§€í–¥ì ì¸", "ê°ì • í‘œí˜„ì´ í’ë¶€í•œ" ë“±',
        "",
        "10) aspired_traits:",
        "- ì˜¤ëŠ˜ì˜ VIVID ê¸°ë¡(Q1, Q2 ëª¨ë‘)ì—ì„œ ë“œëŸ¬ë‚œ ì§€í–¥ ëª¨ìŠµì„ ìµœëŒ€ 5ê°€ì§€ ìž‘ì„±í•©ë‹ˆë‹¤.",
        "- ì‚¬ìš©ìžê°€ ì¶”êµ¬í•˜ëŠ” ê°€ì¹˜ì™€ ë°©í–¥ì„±ì„ ë‚˜íƒ€ë‚´ëŠ” íŠ¹ì„±ìœ¼ë¡œ ìž‘ì„±í•˜ì„¸ìš”.",
        '- ì˜ˆ: "ê· í˜• ìž¡ížŒ ì‚¶ì„ ì¶”êµ¬í•˜ëŠ”", "ì°½ì˜ì ì¸ ë¬¸ì œ í•´ê²°ìž", "íƒ€ì¸ê³¼ì˜ ê¹Šì€ ì—°ê²°ì„ ì›í•˜ëŠ”" ë“±',
        "",
        "í†¤ì€ ë‹´ë°±í•˜ê³  ê³¼í•˜ì§€ ì•Šê²Œ, ì‚¬ìš©ìžë¥¼ ì¡°ìš©ížˆ ì‘ì›í•˜ëŠ” í˜¸ìŠ¤íŠ¸ì²˜ëŸ¼ ìž‘ì„±í•˜ì„¸ìš”.",
      ].join("\n")
    : [
        "VIVID ë¦¬í¬íŠ¸ë¥¼ ê°„ë‹¨í•˜ê²Œ ìƒì„±í•˜ì„¸ìš”.",
        "ì•„ëž˜ JSON ìŠ¤í‚¤ë§ˆì— ë§žê²Œ ì±„ì›Œì£¼ì„¸ìš”.",
        "",
        "VIVID ê¸°ë¡ì€ ë‘ ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆìŠµë‹ˆë‹¤:",
        "- Q1: ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì–´ë–»ê²Œ ë³´ë‚¼ê¹Œ? (í˜„ìž¬ ëª¨ìŠµ)",
        "- Q2: ì•žìœ¼ë¡œì˜ ë‚˜ëŠ” ì–´ë–¤ ëª¨ìŠµì¼ê¹Œ? (ë¯¸ëž˜ ë¹„ì „)",
        "",
        "1) current_summary: Q1 ë‹µë³€ ìš”ì•½ (250ìž ì´ë‚´, êµ¬ì²´ì ì¸ ì¸ì‚¬ì´íŠ¸ì™€ ë§¥ë½ í¬í•¨)",
        "2) current_evaluation: Q1 ë‹µë³€ í‰ê°€ (200ìž ì´ë‚´)",
        "3) current_keywords: Q1 ë‹µë³€ í‚¤ì›Œë“œ (3~5ê°œ)",
        "",
        "4) future_summary: Q2 ë‹µë³€ ìš”ì•½ (250ìž ì´ë‚´, êµ¬ì²´ì ì¸ ì¸ì‚¬ì´íŠ¸ì™€ ë§¥ë½ í¬í•¨)",
        "5) future_evaluation: Q2 ë‹µë³€ í‰ê°€ (200ìž ì´ë‚´)",
        "6) future_keywords: Q2 ë‹µë³€ í‚¤ì›Œë“œ (3~5ê°œ)",
        "",
        "7) alignment_score: ì˜¤ëŠ˜ì˜ ê³„íš(Q1)ì´ ë¯¸ëž˜ ëª©í‘œ(Q2)ì™€ ì–¼ë§ˆë‚˜ ì¼ì¹˜í•˜ëŠ”ì§€ í‰ê°€ (0-100ì )",
        "   - í‰ê°€ ê¸°ì¤€: ì˜¤ëŠ˜ ê³„íší•œ í™œë™ì´ ë¯¸ëž˜ ëª©í‘œ ë‹¬ì„±ì— ë„ì›€ì´ ë˜ëŠ”ê°€, ìš°ì„ ìˆœìœ„ê°€ ì •ë ¬ë˜ì–´ ìžˆëŠ”ê°€, êµ¬ì²´ì ì¸ í–‰ë™ ê³„íšì´ ë¯¸ëž˜ ëª©í‘œë¡œ ì´ì–´ì§€ëŠ”ê°€",
        "   - ë†’ì€ ì ìˆ˜(80ì  ì´ìƒ): ìž˜ ì •ë ¬ë¨, ì¤‘ê°„ ì ìˆ˜(50-79ì ): ë¶€ë¶„ ì •ë ¬, ë‚®ì€ ì ìˆ˜(50ì  ë¯¸ë§Œ): í° ê²©ì°¨",
        "   - ë™ê¸°ë¶€ì—¬ë¥¼ ìœ„í•œ ì ìˆ˜ì´ë¯€ë¡œ ê¸ì •ì ì¸ ê´€ì ì—ì„œ í‰ê°€",
        "",
        "8) alignment_score_reason: ì ìˆ˜ ì‚°ì • ê·¼ê±° (3~5ê°œ ë°°ì—´)",
        '   - Q1ê³¼ Q2ì—ì„œ ê²¹ì¹˜ëŠ” í‚¤ì›Œë“œë‚˜ ì£¼ì œë¥¼ ë¶„ì„í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ì—…í•©ë‹ˆë‹¤.',
        '   - ì˜ˆì‹œ: ["\'ì„±ìž¥\'ì´ë¼ëŠ” ê³µí†µ í‚¤ì›Œë“œ", "ì•„ì¹¨ ìš´ë™ì— ëŒ€í•œ ì˜ì§€ê°€ ì¼ì¹˜í•¨"]',
        "",
        "9) user_characteristics: ì‚¬ìš©ìž íŠ¹ì„± (ìµœëŒ€ 3ê°œ, ê°„ë‹¨í•˜ê²Œ)",
        "10) aspired_traits: ì§€í–¥í•˜ëŠ” ëª¨ìŠµ (ìµœëŒ€ 3ê°œ, ê°„ë‹¨í•˜ê²Œ)",
      ].join("\n");

  let prompt = `ì•„ëž˜ëŠ” ${date} (${dayOfWeek}) í•˜ë£¨ì˜ VIVID ê¸°ë¡ìž…ë‹ˆë‹¤.\n${instruction}\n\n`;

  dreamRecords.forEach((record, idx) => {
    const createdAt = new Date(record.created_at);
    const kstTime = createdAt.toLocaleTimeString("ko-KR", {
      hour: "2-digit",
      minute: "2-digit",
      timeZone: "Asia/Seoul",
    });
    prompt += `${idx + 1}. [${kstTime}] ${record.content}\n`;
  });

  return prompt;
}
